(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;Math.randomInt=function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},c=illuminated.Lamp,f=illuminated.RectangleObject,b=illuminated.DiscObject,e=illuminated.PolygonObject,h=illuminated.Vec2,d=illuminated.Lighting,a=illuminated.DarkMask,i=document.getElementsByTagName("canvas")[0],l=i.getContext("2d"),i.width=window.innerWidth,i.height=window.innerHeight,s={assets:"../assets/"},o=function(a){return null==a&&(a=0),q.load(a),requestAnimFrame(function b(){requestAnimFrame(b,i);var a=+new Date;a>=p+g&&(p=a,w()),t()},i)},m=null,r=[],q={add:function(a){return a.lightings=[],r.push(a)},get:function(a){return m=r[a]},load:function(a){var b;return b=null,m=null,q.get(a),k(),v(),m.action()}},n=null,k=function(){var b,c,e,f,g;for(n=new a({lights:m.lights,color:"rgba(0, 0, 0, 1)"}),f=m.lights,g=[],c=0,e=f.length;e>c;c++)b=f[c],g.push(m.lightings.push(new d({light:b,objects:m.objects})));return g},j=function(){var a,b,c,d,e;for(d=m.lightings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.compute(i.width,i.height));return e},u=function(){var a,b,c,d,e;for(d=m.lightings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.render(l));return e},p=0,g=25,w=function(){return j(),n.compute(i.width,i.height)},v=function(){return w()},t=function(){var a,b;return b=i.width,a=i.height,l.fillRect(0,0,b,a),l.save(),l.fillStyle="white",m.objects.forEach(function(a){var b,c,d;return l.save(),l.beginPath(),a.path(l),l.clip(),c=a.bounds(),d=c.topleft,b=c.bottomright,l.drawImage(resources.get(a.texture),d.x,d.y,b.x-d.x,b.y-d.y),l.restore(),l.save(),l.beginPath(),a.path(l),l.restore()}),l.globalCompositeOperation="lighter",u(),l.restore(),l.globalCompositeOperation="source-over",n.render(l)},q.add({objects:[new f({topleft:new h(i.width-150,i.height/2+225),bottomright:new h(i.width,i.height/2-225),texture:s.assets+"exit.png"})],lights:[new c({color:"rgba(255, 255, 255, 1)",position:new h(20,i.height-20),distance:100,radius:50}),new c({color:"rgba("+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.random()+")",position:new h(Math.randomInt(0,i.width),Math.randomInt(0,i.height)),distance:Math.randomInt(100,300),diffuse:.8,radius:Math.randomInt(50,100)}),new c({color:"rgba("+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.random()+")",position:new h(Math.randomInt(0,i.width),Math.randomInt(0,i.height)),distance:Math.randomInt(100,300),diffuse:.8,radius:Math.randomInt(50,100)}),new c({color:"rgba("+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.random()+")",position:new h(Math.randomInt(0,i.width),Math.randomInt(0,i.height)),distance:Math.randomInt(100,300),diffuse:.8,radius:Math.randomInt(50,100)}),new c({color:"rgba("+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.randomInt(0,255)+", "+Math.random()+")",position:new h(Math.randomInt(0,i.width),Math.randomInt(0,i.height)),distance:Math.randomInt(100,300),diffuse:.8,radius:Math.randomInt(50,100)})],action:function(){return window.onkeydown=function(a){var b,c,d,e,f,g,h,i;switch(console.log(a),a.keyCode){case 38:m.lights[0].position.y-=10;break;case 37:m.lights[0].position.x-=10;break;case 40:m.lights[0].position.y+=10;break;case 39:m.lights[0].position.x+=10}for(e=h=1,i=m.lights.length-1;i>=1?i>=h:h>=i;e=i>=1?++h:--h)g=m.lights[0],f=m.lights[e],c=g.position.x+g.distance-(f.position.x+f.distance),d=g.position.y+g.distance-(f.position.y+f.distance),b=Math.sqrt(c*c+d*d),b<g.distance+f.distance&&console.log("collision detected");return m.lights[0].position.x+100>=m.objects[0].topleft.x&&m.lights[0].position.x<=m.objects[0].bottomright.x&&m.lights[0].position.y+100>=m.objects[0].topleft.y&&m.lights[0].position.y<=m.objects[0].bottomright.y?console.log("finish collision"):void 0}}}),q.add({objects:[new f({topleft:new h(0,600),bottomright:new h(i.width,100)}),new f({topleft:new h(100,i.height-500),bottomright:new h(250,i.height-175),texture:s.assets+"player.png"})],lights:[new c({color:"rgba(255, 0, 0, 1)",distance:30}),new c({color:"rgba(255, 255, 255, 0.2)",distance:100,position:new h(600,700)})]}),q.add({objects:[new f({topleft:new h(0,600),bottomright:new h(i.width/2,50)})],lights:[new c({color:"rgba(0, 255, 0, 1)",distance:30})]}),resources.load([s.assets+"exit.png"]),resources.onReady(o)}).call(this);